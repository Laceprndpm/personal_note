---
title: "[ONTAK2010] Peaks"
date: 2025-11-08
last_clear: 2025-11-08
tags:
  - tag/图论/树上问题/MST/Kruscal重构树
  - tag/LCA
grasp: 4
value: 4
difficulty:
optional_difficulty: Easy-Medium
source: https://www.luogu.com.cn/problem/P4197
article:
---

```cpp showLineNumbers
void solve()
{
    int n, m, q;
    cin >> n >> m >> q;
    vector<tuple<int, int, int>> edges;
    vector<vector<int>>          adj(2 * n);
    vector<int>                  ki(2 * n);
    vector<int>                  hi(2 * n, 0);
    for (int i = 1, h; i <= n; i++) {
        cin >> h;
        hi[i] = h;
    }
    for (int i = 0; i < m; i++) {
        int a, b, c;
        cin >> a >> b >> c;
        edges.pb({c, a, b});
    }
    sor(edges);
    DSU dsu(2 * n);
    int cnt = n;
    for (int i = 0; i < m; i++) {
        auto [c, a, b] = edges[i];
        if (dsu.same(a, b)) {
            continue;
        } else {
            ++cnt;
            ki[cnt] = c;
            adj[cnt].pb(dsu.find(a));
            adj[cnt].pb(dsu.find(b));
            dsu.merge(cnt, a);
            dsu.merge(cnt, b);
        }
    }
    int                    dfscnt = 0;
    vector<int>            in(2 * n), out(2 * n);
    vector<int>            dfsnhi(2 * n, 0);
    vector<array<int, 20>> fa(2 * n);
    auto                   dfs = [&](auto&& self, int u) -> void {
        dfscnt++;
        in[u]          = dfscnt;
        dfsnhi[dfscnt] = hi[u];
        for (int v : adj[u]) {
            if (ki[v] == 0) ki[v] = ki[u];
            fa[v][0] = u;
            self(self, v);
        }
        out[u] = dfscnt;
    };
    dfs(dfs, 2 * n - 1);
    fa[2 * n - 1][0] = 2 * n - 1;
    for (int j = 1; j < 20; j++) {
        for (int i = 1; i <= 2 * n - 1; i++) {
            fa[i][j] = fa[fa[i][j - 1]][j - 1];
        }
    }
    PresidentTree<int> pst(dfsnhi, 0, INF + 1);
    for (int i = 0; i < q; i++) {
        int v, x, k;
        cin >> v >> x >> k;
        for (int i = 19; i >= 0; i--) {
            if (ki[fa[v][i]] <= x) {
                v = fa[v][i];
            }
        }
        int l = in[v], r = out[v];
        if (r - l + 1 < k) {
            cout << -1 << '\n';
            continue;
        }
        int res = pst.getKth(l, r, k);
        if (res == 0) {
            res = -1;
        }
        cout << res << '\n';
    }
}
```
