## 常见形式幂级数恒等式

### 1. 等比数列生成函数

$$
\sum_{n=0}^{\infty} x^n = \frac{1}{1 - x}, \quad |x| < 1
$$
$$
\sum_{n=0}^{\infty} a^n x^n = \frac{1}{1 - a x}
$$
$$
\sum_{n=0}^{\infty} (-1)^n x^n = \frac{1}{1 + x}
$$

---

### 2. 幂的生成函数（组合数）

$$
\frac{1}{(1 - x)^k} = \sum_{n=0}^{\infty} \binom{n + k - 1}{k - 1} x^n
$$

- 特例：$$ \frac{1}{(1 - x)^2} = \sum_{n=0}^{\infty} (n + 1)x^n $$

---

### 3. 幂级数复合：幂级数替换仍合法

若 $$ f(x) \in \mathbb{K}[[x]] $$，则

$$
\sum_{n=0}^\infty f(x)^n = \frac{1}{1 - f(x)}
$$

- 说明：这是 **幂级数定义**，不是从 $$ \frac{1}{1 - x} $$ 代入 $$ x \to f(x) $$ 得到的

---

### 4. 幂级数乘法逆元（Formal Inverse）

若 $$ A(x) = 1 + a_1 x + a_2 x^2 + \cdots $$，且 $$ A(0) \ne 0 $$，则存在唯一 $$ B(x) $$ 使得：

$$
A(x) \cdot B(x) = 1 \mod x^n
$$

- 求法：Newton 迭代法（乘法逆）

---

### 5. 幂级数复合逆（Compositional Inverse）

若 $$ f(x) = x \phi(f(x)) $$，且 $$ \phi(0) \ne 0 $$，则其复合逆 $$ f^{\langle -1 \rangle}(x) $$ 的系数由 Lagrange 反演给出：

$$
[x^n] f^{\langle -1 \rangle}(x) = \frac{1}{n} [x^{n-1}] \phi(x)^n
$$

- 举例：$$ f(x) = x + x^2 $$ 的复合逆是 $$ x - x^2 + 2x^3 - 5x^4 + \cdots $$

---

### 6. 幂级数指数与对数互为复合逆

$$
\exp(x) = \sum_{n=0}^{\infty} \frac{x^n}{n!}, \quad \log(1 + x) = \sum_{n=1}^{\infty} \frac{(-1)^{n+1} x^n}{n}
$$

满足：

$$
\log(\exp(x)) = x, \quad \exp(\log(1 + x)) = 1 + x
$$

---

### cf 451E:
若每种有 $f_i$ 朵鲜花
$$
F_i(x) = 1 + x + x^2 + \dots + x^{f_i} = \frac{1-x^{f_i+1}}{1-x}
$$
$$
F(x) = \prod_i F_i(x) = \frac{\prod_{i = 1}^n (1-x^{f_i + 1})}{(1-x)^n} = \frac{A(x)}{(1-x)^n} \quad \text{where } A(x) = \prod_i(1-x ^{f_i+1})
$$
$$
[x^s]F(x) = \sum_i [x^i] A(x) \cdot[x ^{s - i}] \frac{1}{(1-x)^n} = \sum_i[x^i]A(x) \cdot \binom{s-i + n - 1}{n - 1}
$$
最终，枚举即可在 $O(2^n)$ 内解决。组合数可以暴力计算，总复杂度 $O(n\cdot 2^n)$ 。

容斥：
设 $a_i$ 为在第$i$个箱子里超了
则
$$
N((1-a_1)(1-a_2)\dots (1-a_i)) =  \sum_{s \subseteq S}{(-1)^{|s|}N \left( \prod_{i\in s} a_i \right)}
$$
### Luogu P6078:
同上，可得到 $O(b-a) n \cdot 2^n$ 的解法
但对于最后一步
$$
\sum_{s = a}^b \sum_i[x^i]A(x) \cdot \binom{s-i + n - 1}{n - 1} = \sum_i[x^i]A(x) \sum_{s = a}^b \binom{s-i + n - 1}{n - 1}
$$
化简成:
$$
\sum_i[x^i]A(x) \left(\binom{b-i + n}{n} - \binom{a-i + n - 1}{n} \right)
$$
ALL CLEAR
