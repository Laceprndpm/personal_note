abc162 E:
$$
\begin{align}
ans &= \sum_{d=1}^kd \sum_{d|d'}\mu\left(\frac{d'}{d}\right) \left\lfloor\frac{k}{d'}\right\rfloor^N \\
&= \sum_{d'=1}\left\lfloor\frac{k}{d'}\right\rfloor^N\sum_{d|d'}d\cdot\mu\left(\frac{d'}{d}\right) \\
&= \sum_{d'=1}^k \left\lfloor\frac{k}{d'}\right\rfloor^N \varphi(d')
\end{align}
$$
重要恒等式:
$$
\boxed{
\sum_{d \mid n} d \cdot \mu\left( \frac{n}{d} \right) = \varphi(n)
}
$$
agc038 C:
$$
\begin{align}
& \sum_{i=0}^{N} \sum_{j=0}^{N} \mathrm{lcm}(A_i, A_j) \\
& \quad = \sum_{i=0}^{N} \sum_{j=0}^{N} \frac{A_i A_j}{\gcd(A_i, A_j)} \\
& \quad = \sum_{d=1}^{L} \frac{1}{d} \sum_{i=0}^{N} \sum_{j=0}^{N} A_i A_j \cdot [\gcd(A_i, A_j) = d]
\quad \text{where} \quad L = \max_{z=0}^{N} (A_z)
\end{align}
$$
$$
\begin{align}
f(d) &= \sum_{i=0}^{N} \sum_{j=0}^{N} A_i A_j \cdot [\gcd(A_i, A_j) = d] \\
g(d) &= \sum_{d \mid d'} f(d') 
= \left( \sum_{i=0}^{N} A_i \cdot [d \mid A_i] \right)^2 \\
f(d) &= \sum_{d \mid d'} \mu\left(\frac{d'}{d}\right) g(d') \\
&= \sum_{d \mid d'} \mu\left(\frac{d'}{d}\right) \left( \sum_{i=0}^{N} A_i \cdot [d' \mid A_i] \right)^2
\end{align}
$$
$$
\begin{align}
& \sum_{i=0}^{N} \sum_{j=0}^{N} \mathrm{lcm}(A_i, A_j) \\
& \quad = \sum_{d=1}^{L} \frac{1}{d} \sum_{d|d'} \mu\left(\frac{d'}{d}\right)\left( \sum_{i=0}^{N} A_i \cdot [d' \mid A_i] \right)^2
\end{align}
$$
设:
$$
h(x) = \sum_{i=0}^{N} A_i \cdot [d' \mid A_i]
$$
则可以用桶计数的方法，$O(n + L \log L)$ 的时间复杂度求解所有 $h(x)$ ，随后的$G(d) = \sum_{d|d'} \mu\left(\frac{d'}{d}\right)h(d')^2$ 又可以 $O(L \log L)$ 求出。
最终 $O(n)$ 求得 $\sum i \cdot G(i)$ 为答案。

### 狄利克雷卷积
$$
\boxed{
\begin{aligned}
&\text{For all } n, \quad h(n) = \sum_{d \mid n} f(d)\, g\left( \frac{n}{d} \right) \\
&\text{Equivalent to:} \\
&\quad \text{for } d \text{ in range}(1, n + 1): \\
&\quad\quad \text{for } j \text{ in range}(1, \left\lfloor \frac{n}{d} \right\rfloor + 1): \\
&\quad\quad\quad h(d \cdot j) \mathrel{+}= f(d) \cdot g(j)
\end{aligned}
}
$$

狄利克雷卷积:
$$
\boxed{
\begin{aligned}
(f*g)(n) = \sum_{d \mid n} f(d)\, g\left( \frac{n}{d} \right) 
\end{aligned}
}
$$
若 $f(n), g(n)$ 为积性函数，则 $f*g$ 为积性函数
$$
\boxed{
\begin{align}
\varepsilon &= \mu * 1 \\
\mathrm{id} &= \varphi * 1 \\
\varphi &= \mu * \mathrm{id}
\end{align}
}
$$
设 $a \in \{1,2,\dots,n\}$，则 $\gcd(a,n)$ 必为 $n$ 的因数。  
分类统计所有 $\gcd(a,n) = d$ 的 $a$ 有多少个:
令 $a = d \cdot k$，则 $1 \le k \le n/d$ 且 $\gcd(k, n/d) = 1$  
因此这类 $a$ 的个数为 $\phi(n/d)$。
所有可能的 $\gcd(a,n)$ 构成划分，故:
$$
n = \sum_{d \mid n} \phi(n/d)
$$
得:
$$
\boxed{\mathrm{id} = \phi * 1}
$$
ALL CLEAR
