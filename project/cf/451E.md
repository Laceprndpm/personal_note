---
title: E. Devu and Flowers
date: 2025-08-13
last_clear: 2025-08-13
tags:
  - tag/计数/容斥
  - tag/math/多项式和生成函数
grasp: 1
difficulty: 2300
source: https://codeforces.com/contest/451/problem/E
article: https://ac.nowcoder.com/study/live/731/6/1
---
# 题意
$n$ 个可区分的盒子，取 $s$ 朵花，同一个盒子内的花不可区分，不同盒子的花可区分，求方案数。
$(1 \le n \le 20, \ 0 \le s \le 10^{14},\ 0 \le f_i \le 10^{12})$ 
# Solution
## 生成函数
若每种有 $f_i$ 朵鲜花
$$
F_i(x) = 1 + x + x^2 + \dots + x^{f_i} = \frac{1-x^{f_i+1}}{1-x}
$$
$$
F(x) = \prod_i F_i(x) = \frac{\prod_{i = 1}^n (1-x^{f_i + 1})}{(1-x)^n} = \frac{A(x)}{(1-x)^n} \quad \text{where } A(x) = \prod_i(1-x ^{f_i+1})
$$
$$
[x^s]F(x) = \sum_i [x^i] A(x) \cdot[x ^{s - i}] \frac{1}{(1-x)^n} = \sum_i[x^i]A(x) \cdot \binom{s-i + n - 1}{n - 1}
$$
最终，枚举即可在 $O(2^n)$ 内解决。组合数可以暴力计算，总复杂度 $O(n\cdot 2^n)$ 。
## 容斥：
设 $a_i$ 为在第$i$个箱子里超了
则
$$
N((1-a_1)(1-a_2)\dots (1-a_i)) =  \sum_{s \subseteq S}{(-1)^{|s|}N \left( \prod_{i\in s} a_i \right)}
$$
可惜本题生成函数和容斥在推完式子后，后续似乎完全一致。
```c++
void solve()
{
    i64 n, s;
    cin >> n >> s;
    vector<i64> arr(n);
    for (int i = 0; i < n; i++) {
        cin >> arr[i];
    }
    const int b   = 1 << n;
    Z         ans = 0;
    for (int i = 0; i < b; i++) {
        i64 cur_sum = s;
        for (int j = 0; j < n; j++) {
            if (i >> j & 1) cur_sum -= arr[j] + 1;
        }
        int cnt = __builtin_popcount(i);

        ans += comb.sp_binom(cur_sum + n - 1, n - 1) * (cnt % 2 == 0 ? 1 : -1);
    }
    cout << ans << '\n';
}
```
