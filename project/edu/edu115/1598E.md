---
title: E. Staircases
date: 2025-11-17
last_clear: 2025-11-17
tags:
  - edu
  - tag/dp/计数
  - tag/暴力
  - tag/模拟
grasp: 5
value: 2
difficulty: 2100
optional_difficulty:
source: https://codeforces.com/contest/1598/problem/E
article:
---
依然很难想象这题曾经是2100，会算复杂度随便写
```cpp
void solve()
{
    int n, m, q;
    cin >> n >> m >> q;
    vector<vector<array<i64, 2>>> dp(n + 2, vector<array<i64, 2>>(m + 2));
    i64                           ans = 0;
    for (int i = n; i >= 1; i--) {
        for (int j = m; j >= 1; j--) {
            ans += (dp[i][j][0] = (dp[i][j + 1][1] + (j + 1 <= m)));
            ans += (dp[i][j][1] = (dp[i + 1][j][0] + (i + 1 <= n)));
        }
    }
    ans += n * m;
    vector<vector<int>> board(n + 2, vector<int>(m + 2));
    for (int i = 0; i < n + 2; i++) {
        board[i][0]     = 1;
        board[i][m + 1] = 1;
    }
    for (int i = 0; i < m + 2; i++) {
        board[0][i]     = 1;
        board[n + 1][i] = 1;
    }
    while (q--) {
        int x, y;
        cin >> x >> y;
        board[x][y] ^= 1;
        int up1 = 0;
        {
            int xx = x, yy = y;
            for (up1 = 1;; up1++) {
                if (up1 & 1) {
                    xx--;
                } else {
                    yy--;
                }
                if (board[xx][yy]) break;
            }
        }
        int down1;
        {
            int xx = x, yy = y;
            for (down1 = 1;; down1++) {
                if (!(down1 & 1)) {
                    xx++;
                } else {
                    yy++;
                }
                if (board[xx][yy]) break;
            }
        }
        int up2 = 0;
        {
            int xx = x, yy = y;
            for (up2 = 1;; up2++) {
                if (!(up2 & 1)) {
                    xx--;
                } else {
                    yy--;
                }
                if (board[xx][yy]) break;
            }
        }
        int down2;
        {
            int xx = x, yy = y;
            for (down2 = 1;; down2++) {
                if (down2 & 1) {
                    xx++;
                } else {
                    yy++;
                }
                if (board[xx][yy]) break;
            }
        }
        ans += (board[x][y] ? -1 : 1) * (1ll * up1 * down1 + 1ll * up2 * down2 - 1);
        cout << ans << '\n';
    }
}
```