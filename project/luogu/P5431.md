---
title: 【模板】模意义下的乘法逆元 2
date: 2025-12-12
last_clear: 2025-12-12
tags:
  - luogu
  - tag/math/数论
grasp:
value:
difficulty:
optional_difficulty:
source: https://www.luogu.com.cn/problem/P5431
article:
---
```cpp
constexpr int INF = 1e9;
int           P;

int qmi(ll base, int q)
{
    ll res = 1;
    for (; q; q >>= 1) {
        if (q & 1) res = res * base % P;
        base = base * base % P;
    }
    return res;
}

u32 prefix[5000050], prefixinv[5000050], arr[5000050];

void solve()
{
    u32 n, k;
    cin >> n >> P >> k;
    for (int i = 1; i <= n; i++) {
        cin >> arr[i];
    }
    prefix[0] = 1;
    for (int i = 1; i <= n; i++) {
        prefix[i] = (u64)prefix[i - 1] * arr[i] % P;
    }
    prefixinv[n] = qmi(prefix[n], P - 2);
    for (int i = n - 1; i >= 0; i--) {
        prefixinv[i] = (u64)prefixinv[i + 1] * arr[i + 1] % P;
    }
    i128 ans = 0;
    u64  cur = k;
    for (int i = 1; i <= n; i++) {
        ans = (ans + (cur * prefixinv[i] % P) * prefix[i - 1] % P);
        cur = cur * k % P;
    }
    cout << (u64)(ans % P) << '\n';
}

```
