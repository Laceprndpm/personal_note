---
title: E. Replace the Numbers
date: 2025-04-11
last_clear: 2025-11-25
tags:
  - edu
  - tag/thinking
  - tag/dsu
  - tag/细心
  - tag/启发式合并
  - tag/thinking/桶
grasp: 3
value: 4
difficulty: 1900
optional_difficulty:
source: https://codeforces.com/contest/1620/problem/E
article:
---
不能用朴素并查集乱搞，详见样例，以及需要特判2 x x的情况，我这里一开始写错了导致WA++
```text
5
1 1
2 1 2
2 3 4
2 2 3
2 4 5
```
# Solution
## mysolution
从后往前，然后每次只爬一次，防止出现逆序的情况，同时特判掉 $cmd = 2$ 时 $x = y$ 的情况，因为他会同时修改 $f[x]$ 和 $f[y]$ 导致断连。
```cpp showLineNumbers
void solve()
{
    int q;
    cin >> q;
    deque<tuple<int, int, int>> tp;
    for (int i = 0; i < q; i++) {
        int cmd;
        cin >> cmd;
        int x, y;
        if (cmd == 1) {
            cin >> x;
        } else {
            cin >> x >> y;
        }
        tp.pb({cmd, x, y});
    }
    vector<int> ans;
    vector<int> fa(5e5 + 5);
    iota(all(fa), 0);
    for (int i = 0; i < q; i++) {
        auto [cmd, x, y] = tp.back();
        tp.pop_back();
        if (cmd == 2) {
            if (x == y) continue;
            fa[x] = y;
            if (fa[x] != fa[fa[x]]) {
                fa[x] = fa[fa[x]];
            }
        } else {
            ans.pb(fa[x]);
        }
    }
    reverse(all(ans));
    for (int i : ans) {
        cout << i << ' ';
    }
    cout << '\n';
    // 5
    // 1 1
    // 2 1 2
    // 2 3 4
    // 2 2 3
    // 2 4 5
}
```
## dsu_solution
存每个值对应的下标的位置
```cpp showLineNumbers
void solve()
{
    int q;
    cin >> q;
    vector<vector<int>> pos(5e5 + 5);
    int                 ptr   = 0;
    auto                merge = [&](int x, int y) {
        if (pos[x].size() < pos[y].size()) {
            swap(pos[x], pos[y]);
        }
        pos[x].ins(pos[x].end(), all(pos[y]));
        pos[y].clear();
    };
    for (int i = 0; i < q; i++) {
        int cmd;
        cin >> cmd;
        int x, y;
        if (cmd == 1) {
            cin >> x;
            pos[x].pb(ptr++);
        } else {
            cin >> x >> y;
            if (x == y) continue;
            merge(y, x);
        }
    }
    vector<int> ans(ptr);
    for (int i = 0; i <= 5e5; i++) {
        for (int p : pos[i]) {
            ans[p] = i;
        }
    }
    for (int i : ans) {
        cout << i << ' ';
    }
    cout << '\n';
}
```