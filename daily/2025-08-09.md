### codeforces891 E
求解：
$$
\begin{align}
& E((a_1 - x_1)(a_2 - x_2)\dots(a_n - x_n)) \\[10pt]
& \quad =\frac{\sum_{x_1 + x_2 + \dots + x_n = k} (a_1 - x_1)(a_2 - x_2)\dots(a_n - x_n) \cdot \binom{k}{x_1,x_2,\dots,x_n}}{n^n} \\[10pt]
& \quad = \frac{k!}{n^n} \sum_{x_1 + x_2 + \dots + x_n = k} \frac{(a_1 - x_1)}{x_1!} \frac{(a_2 - x_2)}{x_2!} \dots \frac{(a_n - x_n)}{x_n!} 
\end{align}
$$
令：
$$
F_i(x) = \sum_{j \ge 0} \frac{(a_i - j)}{j!} x^j
$$
$$
ans = [x^k]\left(F_1(x)F_2(x)\dots F_n(x)\right)
$$
$$
\begin{align}
F_i(x) &= \sum_{j \ge 0} \frac{(a_i - j)}{j!} x^j = \sum_{j \ge 0}\frac{a_i}{j!}x^j - \sum_{j \ge 0} \frac{j}{j!}x^j \\
&= a_i\exp(x) - x \exp(x) \\
&= (a_i - x) \exp(x)
\end{align}
$$
$$
F(x) = \prod_{i = 1}^{n}(a_i - x) \exp(nx)
$$
因为 $n \le 5000$ ，可以暴力求解 $\prod_{i = 1}^{n}(a_i - x)$ 
$$
A(x) = \prod_{i = 1}^{n}(a_i - x)
$$
$$
[x^k]F(x) = \sum_{i = 0}^{n}[x^i]A(x)\cdot [x^{k - i}] \exp(nx)
$$
## review:
- 形式幂级数
- 常生成函数
- 递推关系
- 指数生成函数

# 8:
关于 DFT
感觉没有 3b1b 讲的清楚
总结一下就是讲了复数

$$
A(x) = a_0 + a_1x + \dots + a_{n - 1} x^{n-1}
$$
$$
\begin{align}
B(x) = a_0 + a_2x + \dots + a_{n-2}x^{\frac{n}{2} - 1} \\
C(x) = a_1 + a_3x + \dots + a_{n - 1} x^ {\frac{n}{2} - 1}
\end{align}
$$
$$
A(x) = B(x^2) + C(x^2)
$$
$$
\begin{align}
A(w_n^k) 
&= B(w_n^{2k}) + w_n^k C(w_n^{2k}) \\
&= B(w_{\frac{n}{2}}^k) + w_n^kC(w_{\frac{n}{2}}^k) \\
A(w_n^{k + \frac{n}{2}})
&= B(w_n^{2k\cancel{+ n}}) + w_n^{k + \frac{n}{2}} C(w_n^{2k\cancel{+ n}}) \\
&= B(w_{\frac{n}{2}}^{k}) - w_{n}^{k} C(w_{\frac{n}{2}}^{k})
\end{align}
$$
$$
T(n) = 2\cdot T(n / 2) + O(n) = O(n\log n)
$$
$$
\begin{array}{cccccccc}
(a_0 & a_1 & a_2 & a_3 & a_4 & a_5 & a_6 & a_7) \\
(a_0 & a_2 & a_4 & a_6) & (a_1 & a_3 & a_5 & a_7) \\
(a_0 & a_4) & (a_2 & a_6) & (a_1 & a_5) & (a_3 & a_7) \\
(a_0) & (a_4) & (a_2) & (a_6) & (a_1) & (a_5) & (a_3) & (a_7)
\end{array}
$$
若：
$$
\begin{align}
C(w_2^0) &= a_0 + w_2^0\cdot a_4 \\
C(w_2^1) &= a_0 - w_2^0\cdot a_4 \\[6pt]
D(w_2^0) &= a_2 + w_2^0\cdot a_6 \\
D(w_2^1) &= a_2 - w_2^0\cdot a_6 \\[10pt]
\end{align}
$$
$$
\begin{align}
B(w_4^0) &= C(w_2^0) + w_4^0 \cdot D(w_2^0) \\
B(w_4^1) &= C(w_2^1) + w_4^1 \cdot D(w_2^1) \\
B(w_4^2) &= C(w_2^0) - w_4^0 \cdot D(w_2^0) \\
B(w_4^3) &= C(w_2^1) - w_4^1 \cdot D(w_2^1)
\end{align}
$$
## IDFT:
$$
\mathrm{DFT}:
\quad
\begin{bmatrix}
X_0 \\
X_1 \\
\vdots \\
X_{n-1}
\end{bmatrix}
=
\begin{bmatrix}
\omega_n^0 & \omega_n^0 & \omega_n^0 & \cdots & \omega_n^{0 (n-1)} \\
\omega_n^0 & \omega_n^1 & \omega_n^2 & \cdots & \omega_n^{1(n-1)} \\
\omega_n^0 & \omega_n^2 & \omega_n^4 & \cdots & \omega_n^{2(n-1)} \\
\vdots & \vdots & \vdots & \ddots & \vdots \\
\omega_n^0 & \omega_n^{n-1} & \omega_n^{2(n-1)} & \cdots & \omega_n^{(n-1)(n-1)}
\end{bmatrix}
\begin{bmatrix}
x_0 \\
x_1 \\

\vdots \\
x_{n-1}
\end{bmatrix}
$$

$$
\Omega=
\begin{bmatrix}
\omega_n^0 & \omega_n^0 & \omega_n^0 & \cdots & \omega_n^{0 (n-1)} \\
\omega_n^0 & \omega_n^1 & \omega_n^2 & \cdots & \omega_n^{1(n-1)} \\
\omega_n^0 & \omega_n^2 & \omega_n^4 & \cdots & \omega_n^{2(n-1)} \\
\vdots & \vdots & \vdots & \ddots & \vdots \\
\omega_n^0 & \omega_n^{n-1} & \omega_n^{2(n-1)} & \cdots & \omega_n^{(n-1)(n-1)}
\end{bmatrix}
$$
$$
\overline{\Omega}
=
\begin{bmatrix}
\omega_n^{0 \cdot 0} & \omega_n^{0 \cdot 1} & \omega_n^{0 \cdot 2} & \cdots & \omega_n^{0 \cdot (n-1)} \\
\omega_n^{1 \cdot 0} & \omega_n^{1 \cdot 1} & \omega_n^{1 \cdot 2} & \cdots & \omega_n^{1 \cdot (n-1)} \\
\omega_n^{2 \cdot 0} & \omega_n^{2 \cdot 1} & \omega_n^{2 \cdot 2} & \cdots & \omega_n^{2 \cdot (n-1)} \\
\vdots & \vdots & \vdots & \ddots & \vdots \\
\omega_n^{(n-1) \cdot 0} & \omega_n^{(n-1) \cdot 1} & \omega_n^{(n-1) \cdot 2} & \cdots & \omega_n^{(n-1) \cdot (n-1)}
\end{bmatrix}
$$
$$
M = \Omega \cdot \overline{\Omega}
$$
$$
M_{ij} = \sum_{k=0}^{n-1} \omega_n^{i k} \cdot \omega_n^{-j k} = \sum_{k=0}^{n-1} \omega_n^{(i - j) k}
$$
$$
M_{ij} =
\begin{cases}
n, & \text{if } i = j \\
\frac{1-(\omega_n^{j-i})^n}{1-\omega_n^{j-i}} = 0, & \text{if } i \neq j
\end{cases}
$$

$$
M = \Omega \cdot \overline{\Omega} = n \cdot I
$$
$$
\mathrm{IDFT}:
\quad
\begin{bmatrix}
x_0 \\
x_1 \\
\vdots \\
x_{n-1}
\end{bmatrix}
=
\frac{1}{n}
\begin{bmatrix}
\omega_n^{0 \cdot 0} & \omega_n^{0 \cdot 1} & \omega_n^{0 \cdot 2} & \cdots & \omega_n^{0 \cdot (n-1)} \\
\omega_n^{1 \cdot 0} & \omega_n^{1 \cdot 1} & \omega_n^{1 \cdot 2} & \cdots & \omega_n^{1 \cdot (n-1)} \\
\omega_n^{2 \cdot 0} & \omega_n^{2 \cdot 1} & \omega_n^{2 \cdot 2} & \cdots & \omega_n^{2 \cdot (n-1)} \\
\vdots & \vdots & \vdots & \ddots & \vdots \\
\omega_n^{(n-1) \cdot 0} & \omega_n^{(n-1) \cdot 1} & \omega_n^{(n-1) \cdot 2} & \cdots & \omega_n^{(n-1) \cdot (n-1)}
\end{bmatrix}
\begin{bmatrix}
X_0 \\
X_1 \\
\vdots \\
X_{n-1}
\end{bmatrix}
$$

### codeforces 528D:

若求匹配，且字符种类少，则可以逐字符匹配。
$$
\begin{align}
S(x) = \sum_{i = 1}^{n} [S_{string}[i] = \text{'A'}]x^i \\
T(x) = \sum_{i = 1}^{n} [T_{string}[i] = \text{'A'}]x^i
\end{align}
$$

随后
$$
\begin{align}
F(x) &= \text{rev}(S(x)) \cdot T(x) \\
a_i &= \sum_{l = 1,\ r = i - l}^{|T|} \left[S_{string}^{rev}[r] = T_{string}[l]\right] \\
&= \sum_{l = 1}^{|T|} \left[S_{string}[n + 1 - i + l] = T_{string}[l]\right]
\end{align}
$$
## 拉格朗日插值：
$$
\boxed{
f_{n - 1}(x) = \sum_{i = 1}^n y_i \prod_{j \neq i} \frac{x - x_j}{x_i - x_j} 
}
$$

$$
\begin{align}
f(x) &= f_1(x) + f_2(x) + \dots + f_n(x) \\
x &= x_1 \text{ 时 } f_{2\dots n} (x) = 0 \\
f_1(x_1) &= A(x_1-x_2)\dots (x_1-x_n) = y_1 \\
A &= \frac{y_1}{(x_1 - x_2)\dots (x_1 - x_n)}
\end{align}
$$
和 CRT 高度相似：
$$
\begin{cases}
f(x) \equiv y_1 & \pmod{x - x_1} \\
f(x) \equiv y_2 & \pmod{x - x_2} \\
\quad \vdots \\
f(x) \equiv y_n & \pmod{x - x_n} 
\end{cases}
$$
$$
\begin{align}
f(x) \mod g(x) = r(x) \\
\text{或 } f(x) \equiv r(x) \bmod g(x) \\
f(x) = q(x) \cdot g(x) + r(x) \\
\text{where deg r(x) < deg g(x)}
\end{align}
$$
$$
\begin{align}
f(x) - f(x_i) &= a_0 - a_0\\ 
&+ a_1(x - x_i) \\
&+ a_2(x + x_i)(x - x_i) \\
& \dots \\ 
& a_n(x^{(n-1)} + \dots)(x - x_i)
\end{align}
$$
实现：
- 先求 $g(x) = \prod_{i = 1}^n(x-x_i)$ 。求 $n$ 次 $\frac{g(x)}{(x-x_i)}$ 按照权值相加。$O(n^2)$ 
- case1: 只求一个 $f(x_0)$ 。$O(n^2)$ 
- case2: 只求一个 $f(x_0)$ ，且 $x_i = i$ 。预处理阶乘 $O(n)$
### cf 622 F
求
$$
\sum_{i = 1}^{n} i^k \mod 1e9 + 7
$$
因为最高次项为 $i^k$ ，且由 $i^k$ 累加而来。
$$
f(n) = \sum_{i = 1}^{n} i^k
$$
猜测为 k + 1 次多项式
$$
\begin{align}
k &= 0 \quad f(n) = n \\
k &= 1 \quad f(n) = \frac{n(n+1)}{2} \\
k &= 2 \quad f(n) = \frac{n(n+1)(n+2)}{6} \\
\end{align}
$$$$
n^m = \sum_{k = 0} ^m \left\{ \begin{array}{c} m \\ k \end{array} \right\} n^{\underline{k}}
$$
$$
f(n) = \sum_{i = 1}^n i^k = \sum_{i = 1}^n\sum_{j = 0}^k \left\{ \begin{array}{c} m \\ k \end{array} \right\} i^{\underline{k}} = \sum_{j = 0}^k\left\{ \begin{array}{c} m \\ k \end{array} \right\} \sum_{i = 1}^n i^{\underline{k}}
$$
由
$$
\Delta \left(\frac{i^{\underline{k+1}}}{k+1}\right) = \frac{(i+1)^{\underline{k+1}} - i^{\underline{k+1}}}{k+1} = i^{\underline{k}} \implies \sum_{i=1}^n i^{\underline{k}} = \frac{(n+1)^{\underline{k+1}}}{k+1}
$$
但是如果求第二类斯特林数的1e6范围，较为困难，但我们可以利用其是k + 1 次多项式的性质，用**拉格朗日插值**即可。
求出
$$
f(1),\;f(2) \dots f(k + 1)
$$
前 k + 2 项，可以在 $O(k \log k)$ 内求解。
随后在特殊情况二中，以 $O(k)$ 求解。
### 2019ICPC南昌或南京邀请赛B
$n$ 次多项式 $f(x)$ ，给定 $f(0),f(1),\dots,f(n)$ ，求 $m$ 次 $\sum_{i = L}^R f(i) \mod 9999991$ 。$T$ 组询问 $(1 \le T \le 5, \; 1\le n \le 1000, \; 1\le m \le 2000, \; 1 \le L \le R \le 9999990)$。
设。
$$
S(x) = \sum_{i = 1}^xf(i)
$$
则求 $S(R) - S(L - 1)$ 即为答案。
因为 $f(x)$ 为 $n$ 次多项式， $S(x)$ 就为 $n+1$ 次多项式 ==可以说是离散多项式上的积分== 
那么拉格朗日插值求得 $S(x)$ ，可以得到 $O(T \cdot mn)$ 的算法。
### 2021-2022 ACM-ICPC Brazil Subergional Programming Contest A

给定正整数序列 $p_1, \; p_2 \dots p_n$ 和正整数 $R$ ，求有多少正整数序列 $a_1, \dots , a_n$ 满足：
- $p_i \le a_i \le R$
- $a_1 \ge a_2 \ge \dots \ge a_n$
答案对 $1e9 + 7$ 取模

设 $f(i, x)$ 为 $a_i = x$ 时的方案数。
则有递推公式
$$
f(i, x) = \sum_{j = p_{i + 1}}^x f(i + 1, j)
$$
则 $i = n$ 时，$f(n, x) = 1$ 为 $0$ 次多项式。
由递推公式可得，$f(i, x)$ 是 $n - i$ 次多项式。
那么我就可以求
$$
f(i, 0), \ f(i,1), \ f(i,2) \dots f(i, n - i)
$$
来得到这个多项式
#### Trick:
我们求解这些点时，他可能并不是dp值，但是他是dp的值所在函数的真正的$n - i + 1$个点，可以唯一确定这个多项式。
>个人理解指的是 $j<p_{i+1} - 1$ 依然有意义，且不能简单的依赖上文的递推关系直接截断，否则会破坏多项式的连续性。
$$
f(i, j) = S(i + 1, j) - S(i + 1, p_{i + 1} - 1)
$$

其中
$$
S(i, x) = \sum_{j = 1} ^xf(i, j)
$$
对于 $S(i + 1, j)$ 可以直接累加求出
对于 $S(i + 1, p_{i+1} - 1)$ ，考虑到其是一个 $n - i + 1$ 次多项式，依然由特殊情况 2 来 $O(n)$ 求解 $p_{i+1} - 1$ 处的点值。
## Review
- 多项式系数和点值相互转化
- FFT
- 拉格朗日插值

ai:
好，我们就把**组合计数法**讲得尽量细致，把你那个降阶乘求和公式从“组合意义”一步步推导出来。公式回顾一下：  

$$
\sum_{i=1}^{n} i^{\underline{k}} = \frac{(n+1)^{\underline{k+1}}}{k+1}
$$

---

## 第 1 步：理解降阶乘的组合意义

定义：

$$
i^{\underline{k}} = i \cdot (i-1) \cdot \dots \cdot (i-k+1)
$$

**组合解释**：它等于从 $i$ 个不同元素中选出 **有序的 $k$ 个元素**，也就是排列数 $P(i,k)$：

$$
i^{\underline{k}} = P(i,k) = \text{“从 $i$ 个元素中选 $k$ 个并排列的方案数”}
$$

所以：
$$
\sum_{i=1}^{n} i^{\underline{k}} = \sum_{i=1}^{n} P(i,k)
$$
可以理解为：**把 i 从 1 到 n，每个 i 贡献它自己的 k 阶排列数**。

---

## 第 2 步：构造一个更大集合

考虑一个集合 $X$ 有 $n+1$ 个元素。我们想从 $X$ 中选出 $k+1$ 个元素，并对它们排序。  

- 选 $k+1$ 个元素并排列的总数是：
$$
(n+1)^{\underline{k+1}}
$$

---

## 第 3 步：按最大元素分类

设这 $k+1$ 个元素中的**最大元素**为 $i+1$（这里 $i$ 从 0 到 n）。  

- 由于最大元素固定为 $i+1$，剩下 $k$ 个元素必须从前 $i$ 个元素中选择。
- 选择并排列这 $k$ 个元素的方式数：
$$
i^{\underline{k}}
$$

---

## 第 4 步：枚举最大元素

- 最大元素可以从 1 到 $n+1$ 取值。
- 对每个最大元素 $i+1$，都有 $i^{\underline{k}}$ 种排列。
- 所以：
$$
\sum_{i=0}^{n} i^{\underline{k}} = (n+1)^{\underline{k+1}}
$$

---

## 第 5 步：调整下标

- 原公式从 $i=1$ 开始：
$$
\sum_{i=1}^{n} i^{\underline{k}} = \sum_{i=0}^{n} i^{\underline{k}} - 0^{\underline{k}} = \sum_{i=0}^{n} i^{\underline{k}}
$$
因为 $0^{\underline{k}} = 0$ 对于 $k \ge 1$ 不影响结果。  

- 注意组合计数法得到的是 **分组后乘 $k+1$ 的平均**：
$$
\sum_{i=1}^{n} i^{\underline{k}} = \frac{(n+1)^{\underline{k+1}}}{k+1}
$$

为什么要除 $k+1$？  

- 因为每一个排列被我们按最大元素分类，每个集合被 **$k+1$ 种方式计数**（在 $k+1$ 个元素里，谁是最大元素），所以需要除以 $k+1$ 来得到单纯的和。

---
