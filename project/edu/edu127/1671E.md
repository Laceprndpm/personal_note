---
title: E. Preorder
date: 2025-03-20
last_clear: 2025-11-27
tags:
  - edu
  - tag/图论/树
grasp: 4
value: 3
difficulty: 2100
optional_difficulty:
source: https://codeforces.com/contest/1671/problem/E
article:
---
对于两棵树，如果可以通过递归的互换而相同，他们就是等价的，交换后没有意义，所以贡献是 $dp_z = dp_x \cdot dp_y$ ，否则 $dp_z = 2 dp_x \cdot dp_y$ 。而判别等价类，一个常见的做法就是hash，或者直接按照字典序排序。
```cpp showLineNumbers
int n;

tuple<Z, string> dfs(string &s, int depth, int cur)
{
    if (depth == n) {
        string t{""};
        return {1, t + s[cur]};
    }
    auto &&[leftZ, left]   = dfs(s, depth + 1, cur * 2);
    auto &&[rightZ, right] = dfs(s, depth + 1, cur * 2 + 1);

    Z ans = leftZ * rightZ;
    if (left.compare(right)) {
        ans *= 2;
    }
    if (left > right) {
        swap(left, right);
    }
    return {ans, s[cur] + left + right};
}

signed main(int argc, char **argv)
{
    ios::sync_with_stdio(false);
    cin.tie(0);
    cout.tie(0);
#ifdef BATCH
    freopen(argv[1], "r", stdin);
    freopen(argv[2], "w", stdout);
#endif
    cin >> n;
    string s;
    cin >> s;
    s               = ' ' + s;
    auto &&[ans, _] = dfs(s, 1, 1);
    cout << ans << '\n';
    return 0;
}
```
