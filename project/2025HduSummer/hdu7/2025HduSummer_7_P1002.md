---
title: 龙族栖息地
date: 2025-09-11
last_clear: 2025-09-11
tags:
  - tag/三分
  - tag/math
grasp: 2
value: 3
difficulty:
optional_difficulty: Bronze
source: https://acm.hdu.edu.cn/contest/problem?cid=1178&pid=1002
article: file:///home/patchouli/Voile/project/2025HduSummer/attachment/2025HduSummer/7/2025HDU第7场题面题解标程/第7场题解.pdf
---
# 题意
龙穴是龙族的栖息地，它由无限多个正六边形房间铺成。如下图所示，任何一个房间都可以用三维坐标 $(q, r, s)$ 表示（其中 $q,r,s \in \mathbb{Z}$，且 $q + r + s = 0$）；黄色房间的坐标为 $(0,0,0)$。

房间 $(q,r,s)$ 周围一圈 6 个房间按顺时针依次为：  
$$(q,\, r-1,\, s+1),\quad (q+1,\, r-1,\, s),\quad (q+1,\, r,\, s-1),\quad (q,\, r+1,\, s-1),\quad (q-1,\, r+1,\, s),\quad (q-1,\, r,\, s+1).$$
![[2025HduSummer_7_P1002.png]]
龙穴中一共栖息着 $n$ 条龙，第 $i$ 条龙位于 $(q_i, r_i, s_i)$。一个房间可以有多条龙。一条龙一步只能从当前房间移动到相邻房间。龙族准备选择一个房间（该房间可以没有龙）作为龙穴的核心，使得所有 $n$ 条龙移动到该房间所需的最少步数之和尽可能小。请写一个程序帮助龙族确定龙穴核心房间的位置。
## Input
第一行包含一个正整数 $T$（$1 \leq T \leq 300$），表示测试数据的组数。  
每组数据的第一行包含一个正整数 $n$（$2 \leq n \leq 100\,000$），表示栖息在龙穴中的龙的数量。  
接下来 $n$ 行，每行三个整数 $q_i, r_i, s_i$（$|q_i|, |r_i|, |s_i| \leq 10^9,\; q_i + r_i + s_i = 0$），分别表示每条龙所在的房间。  
输入数据保证 $\sum n \leq 1\,000\,000$。  
## Output
对于每组数据，输出一行一个整数，即所有 $n$ 条龙移动到核心房间所需的最少步数之和。  
# Solution
题目给出的其实是六边形网格的立方体坐标表示，在这种表示下，  
从 $(q_1, r_1, s_1)$ 到 $(q_2, r_2, s_2)$ 的最短路步数为  

$$
\frac{|q_1 - q_2| + |r_1 - r_2| + |s_1 - s_2|}{2}。
$$  
设核心房间的坐标是 $(x, y, -x - y)$，则需要最小化：  
$$
f(x, y) = \sum_{i=1}^n \Big(|x - q_i| + |y - r_i| + |-x - y - s_i|\Big)。
$$
固定 $x$ 找最优的 $y$ 是经典问题：$y$ 取  
$$
\{\,r_1, r_2, \ldots, r_n,\; -x-s_1, -x-s_2, \ldots, -x-s_n\,\}
$$  
的中位数，可以通过 `nth_element` 在 $O(n)$ 时间求出。  
另一方面，$f(x, y)$ 求和式的每一项都关于 $x, y$ 二维下凸，因此求和后也是二维下凸，于是三分找到最优的 $x$ 即可。  
时间复杂度：  
$$
O(n \log a)。
$$
>用 `nth_element` 属下下策，尽量排序后，对每个 `vec` 进行二分+计数。否则可能会因常数巨大无法通过。

